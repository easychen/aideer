(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))u(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&u(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function u(r){if(r.ep)return;r.ep=!0;const n=a(r);fetch(r.href,n)}})();try{}catch(e){console.error("[wxt] Failed to initialize plugins",e)}const f="http://localhost:3001",y="/downloads/images",l=document.getElementById("apiUrl"),d=document.getElementById("savePath"),m=document.getElementById("saveBtn"),s=document.getElementById("testBtn"),h=document.getElementById("collectBtn"),c=document.getElementById("status");function o(e,t){c.textContent=e,c.className=`status ${t}`,c.style.display="block",setTimeout(()=>{c.style.display="none"},3e3)}async function p(){return(await chrome.storage.sync.get(["apiUrl"])).apiUrl||f}async function g(){return(await chrome.storage.sync.get(["savePath"])).savePath||y}async function v(e){await chrome.storage.sync.set({apiUrl:e})}async function w(e){await chrome.storage.sync.set({savePath:e})}async function P(e){try{return(await fetch(`${e}/api/health`,{method:"GET",headers:{"Content-Type":"application/json"}})).ok}catch(t){return console.error("Connection test failed:",t),!1}}async function E(){const e=await p(),t=await g();l.value=e,d.value=t}m.addEventListener("click",async()=>{const e=l.value.trim(),t=d.value.trim();if(!e){o("请输入API地址","error");return}if(!t){o("请输入保存路径","error");return}try{new URL(e)}catch{o("请输入有效的URL地址","error");return}try{await v(e),await w(t),o("设置保存成功","success")}catch(a){console.error("Save failed:",a),o("保存失败，请重试","error")}});s.addEventListener("click",async()=>{const e=l.value.trim();if(!e){o("请输入API地址","error");return}s.disabled=!0,s.textContent="测试中...";try{await P(e)?o("连接成功","success"):o("连接失败，请检查地址和服务状态","error")}catch(t){console.error("Test failed:",t),o("测试失败","error")}finally{s.disabled=!1,s.textContent="测试连接"}});h.addEventListener("click",async()=>{try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e.id){o("无法获取当前标签页","error");return}await chrome.tabs.sendMessage(e.id,{action:"show-media-collector"}),window.close()}catch(e){console.error("Failed to start media collection:",e),o("启动失败，请刷新页面后重试","error")}});document.addEventListener("DOMContentLoaded",E);
